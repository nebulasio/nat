CiCjkGZtSjRmHSCJR3UeRg+zjR12OBEW7RPR43ouRpOCVBIaGVcbjfHXBl0fnDap3sbXNtJSwGWxPjmxY9UaGhlXG43x1wZdH5w2qd7G1zbSUsBlsT45sWPVIhAAAAAAAAAAAAAAAAAAAAAAKEAw8LWA5qotOthjCgZkZXBsb3kSzWN7IlNvdXJjZVR5cGUiOiAianMiLCAiU291cmNlIjogImZ1bmN0aW9uIE5yRGF0YUxpc3Qoc3RvcmFnZSwga2V5LCBwYWdlU2l6ZSkge1xuICAgIHRoaXMuX3N0b3JhZ2UgPSBzdG9yYWdlO1xuICAgIHRoaXMuX2tleSA9IGtleTtcbiAgICB0aGlzLl9wYWdlSW5kZXhlcyA9IG51bGw7XG4gICAgdGhpcy5fcGFnZVNpemUgPSBwYWdlU2l6ZTtcbn1cblxuTnJEYXRhTGlzdC5wcm90b3R5cGUgPSB7XG5cbiAgICBfaW5kZXhlc0tleTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gXCJwaXNfXCIgKyB0aGlzLl9rZXk7XG4gICAgfSxcblxuICAgIF9kYXRhS2V5OiBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIFwicGRfXCIgKyB0aGlzLl9rZXkgKyBcIl9cIiArIGluZGV4O1xuICAgIH0sXG5cbiAgICBfbGFzdEluZGV4OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxldCBpbmRleGVzID0gdGhpcy5nZXRQYWdlSW5kZXhlcygpO1xuICAgICAgICBpZiAoaW5kZXhlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gaW5kZXhlc1tpbmRleGVzLmxlbmd0aCAtIDFdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH0sXG5cbiAgICBfYWRkSW5kZXg6IGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICB0aGlzLmdldFBhZ2VJbmRleGVzKCkucHVzaChpbmRleCk7XG4gICAgICAgIHRoaXMuX3NhdmVJbmRleGVzKCk7XG4gICAgfSxcblxuICAgIF9zYXZlSW5kZXhlczogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9zdG9yYWdlLnB1dCh0aGlzLl9pbmRleGVzS2V5KCksIHRoaXMuZ2V0UGFnZUluZGV4ZXMoKSk7XG4gICAgfSxcblxuICAgIGdldFBhZ2VJbmRleGVzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5fcGFnZUluZGV4ZXMpIHtcbiAgICAgICAgICAgIHRoaXMuX3BhZ2VJbmRleGVzID0gdGhpcy5fc3RvcmFnZS5nZXQodGhpcy5faW5kZXhlc0tleSgpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMuX3BhZ2VJbmRleGVzKSB7XG4gICAgICAgICAgICB0aGlzLl9wYWdlSW5kZXhlcyA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9wYWdlSW5kZXhlcztcbiAgICB9LFxuXG4gICAgZ2V0UGFnZURhdGE6IGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICBsZXQgciA9IHRoaXMuX3N0b3JhZ2UuZ2V0KHRoaXMuX2RhdGFLZXkoaW5kZXgpKTtcbiAgICAgICAgaWYgKCFyKSB7XG4gICAgICAgICAgICByID0gW107XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHI7XG4gICAgfSxcblxuICAgIGFkZDogZnVuY3Rpb24gKG9iaikge1xuICAgICAgICBsZXQgaW5kZXggPSB0aGlzLl9sYXN0SW5kZXgoKTtcbiAgICAgICAgbGV0IGkgPSAwO1xuICAgICAgICBpZiAoaW5kZXgpIHtcbiAgICAgICAgICAgIGkgPSBpbmRleC5pO1xuICAgICAgICAgICAgaWYgKGluZGV4LmwgPj0gdGhpcy5fcGFnZVNpemUpIHtcbiAgICAgICAgICAgICAgICBpICs9IDE7XG4gICAgICAgICAgICAgICAgaW5kZXggPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghaW5kZXgpIHtcbiAgICAgICAgICAgIGluZGV4ID0ge2k6IGksIGw6IDB9O1xuICAgICAgICAgICAgdGhpcy5fYWRkSW5kZXgoaW5kZXgpO1xuICAgICAgICB9XG4gICAgICAgIGxldCBkID0gdGhpcy5nZXRQYWdlRGF0YShpbmRleC5pKTtcbiAgICAgICAgZC5wdXNoKG9iaik7XG4gICAgICAgIGluZGV4LmwgKz0gMTtcbiAgICAgICAgdGhpcy5fc2F2ZUluZGV4ZXMoKTtcbiAgICAgICAgdGhpcy5fc3RvcmFnZS5wdXQodGhpcy5fZGF0YUtleShpbmRleC5pKSwgZCk7XG4gICAgfSxcblxuICAgIGFkZFBhZ2U6IGZ1bmN0aW9uIChwYWdlKSB7XG4gICAgICAgIGxldCBpID0gMDtcbiAgICAgICAgbGV0IGluZGV4ID0gdGhpcy5fbGFzdEluZGV4KCk7XG4gICAgICAgIGlmIChpbmRleCkge1xuICAgICAgICAgICAgaSA9IGluZGV4LmkgKyAxO1xuICAgICAgICB9XG4gICAgICAgIGluZGV4ID0ge2k6IGksIGw6IHBhZ2UubGVuZ3RofTtcbiAgICAgICAgdGhpcy5fYWRkSW5kZXgoaW5kZXgpO1xuICAgICAgICB0aGlzLl9zdG9yYWdlLnB1dCh0aGlzLl9kYXRhS2V5KGluZGV4LmkpLCBwYWdlKTtcbiAgICB9LFxuXG4gICAgY2xlYXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbGV0IGluZGV4ZXMgPSB0aGlzLmdldFBhZ2VJbmRleGVzKCk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5kZXhlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdGhpcy5fc3RvcmFnZS5kZWwodGhpcy5fZGF0YUtleShpbmRleGVzW2ldLmkpKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9zdG9yYWdlLmRlbCh0aGlzLl9pbmRleGVzS2V5KCkpO1xuICAgICAgICB0aGlzLl9wYWdlSW5kZXhlcyA9IG51bGw7XG4gICAgfSxcbn07XG5cbmZ1bmN0aW9uIF9jeWNsZU5hbWUoc3RhcnRIZWlnaHQsIGVuZEhlaWdodCkge1xuICAgIHJldHVybiBzdGFydEhlaWdodCArIFwiX1wiICsgZW5kSGVpZ2h0O1xufVxuXG5cbmZ1bmN0aW9uIERhdGFSZWNlaXZlcihzdG9yYWdlKSB7XG4gICAgdGhpcy5fc3RvcmFnZSA9IHN0b3JhZ2U7XG5cbiAgICB0aGlzLl9pbmZvS2V5ID0gXCJkcl9pbmZvXCI7XG4gICAgdGhpcy5faW5kZXhlc0tleSA9IFwiZHJfaW5kZXhlc1wiO1xufVxuXG5EYXRhUmVjZWl2ZXIucHJvdG90eXBlID0ge1xuXG4gICAgZ2V0IF9uYW1lKCkge1xuICAgICAgICBpZiAoIXRoaXMuX2luZm8pIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBfY3ljbGVOYW1lKHRoaXMuX2luZm8uc3RhcnRIZWlnaHQsIHRoaXMuX2luZm8uZW5kSGVpZ2h0KTtcbiAgICB9LFxuXG4gICAgZ2V0IF9pbmZvKCkge1xuICAgICAgICBpZiAoIXRoaXMuX19pbmZvKSB7XG4gICAgICAgICAgICB0aGlzLl9faW5mbyA9IHRoaXMuX3N0b3JhZ2UuZ2V0KHRoaXMuX2luZm9LZXkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9faW5mbztcbiAgICB9LFxuXG4gICAgc2V0IF9pbmZvKGluZm8pIHtcbiAgICAgICAgdGhpcy5fX2luZm8gPSBpbmZvO1xuICAgICAgICB0aGlzLl9zdG9yYWdlLnB1dCh0aGlzLl9pbmZvS2V5LCBpbmZvKTtcbiAgICB9LFxuXG4gICAgZ2V0IF9hbGxEYXRhKCkge1xuICAgICAgICBsZXQgciA9IFtdO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuX2luZGV4ZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGxldCBkID0gdGhpcy5fcGFnZURhdGEodGhpcy5faW5kZXhlc1tpXS5zdGFydEluZGV4KTtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgZC5sZW5ndGg7ICsraikge1xuICAgICAgICAgICAgICAgIHIucHVzaChkW2pdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcjtcbiAgICB9LFxuXG4gICAgZ2V0IF9pbmRleGVzKCkge1xuICAgICAgICBpZiAoIXRoaXMuX19pbmRleGVzKSB7XG4gICAgICAgICAgICB0aGlzLl9faW5kZXhlcyA9IHRoaXMuX3N0b3JhZ2UuZ2V0KHRoaXMuX2luZGV4ZXNLZXkpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5fX2luZGV4ZXMpIHtcbiAgICAgICAgICAgIHRoaXMuX19pbmRleGVzID0gW107XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX19pbmRleGVzO1xuICAgIH0sXG5cbiAgICBzZXQgX2luZGV4ZXMoaW5kZXhlcykge1xuICAgICAgICB0aGlzLl9faW5kZXhlcyA9IGluZGV4ZXM7XG4gICAgICAgIHRoaXMuX3N0b3JhZ2UucHV0KHRoaXMuX2luZGV4ZXNLZXksIGluZGV4ZXMpO1xuICAgIH0sXG5cbiAgICBfcGFnZUtleTogZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICAgIHJldHVybiBcImRyX3BfXCIgKyBpbmRleDtcbiAgICB9LFxuXG4gICAgX3NldFBhZ2VEYXRhOiBmdW5jdGlvbiAoaW5kZXgsIGRhdGEpIHtcbiAgICAgICAgdGhpcy5fc3RvcmFnZS5wdXQodGhpcy5fcGFnZUtleShpbmRleCksIGRhdGEpO1xuICAgIH0sXG5cbiAgICBfcGFnZURhdGE6IGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICBsZXQgciA9IHRoaXMuX3N0b3JhZ2UuZ2V0KHRoaXMuX3BhZ2VLZXkoaW5kZXgpKTtcbiAgICAgICAgaWYgKCFyKSB7XG4gICAgICAgICAgICByID0gW107XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHI7XG4gICAgfSxcblxuICAgIF9nZXROckRhdGE6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIGxldCByID0gW107XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgbGV0IHNjb3JlID0gXCIwXCI7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHNjb3JlID0gQmxvY2tjaGFpbi5nZXRMYXRlc3ROZWJ1bGFzUmFuayhkYXRhW2ldKTtcbiAgICAgICAgICAgIH0gY2F0Y2goZSkge1xuICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBhZGRyZXNzIG5yIG5vdCBmb3VuZCwgZ2l2ZSBhIGRlZmF1bHQgdmFsdWUgXCIwXCJcbiAgICAgICAgICAgICAgICBzY29yZSA9IFwiMFwiO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiTlIgbm90IGZvdW5kIGZvciBhZGRyZXNzOlwiLGRhdGFbaV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgci5wdXNoKHtcbiAgICAgICAgICAgICAgICBhZGRyOiBkYXRhW2ldLFxuICAgICAgICAgICAgICAgIHNjb3JlOiBzY29yZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHI7XG4gICAgfSxcblxuICAgIF9zYXZlRGF0YTogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgbGV0IGluZGV4ZXMgPSB0aGlzLl9pbmRleGVzO1xuICAgICAgICBpbmRleGVzLnB1c2goe3N0YXJ0SW5kZXg6IGRhdGEuc3RhcnRJbmRleCwgbGVuZ3RoOiBkYXRhLmRhdGEubGVuZ3RofSk7XG4gICAgICAgIHRoaXMuX2luZGV4ZXMgPSBpbmRleGVzO1xuICAgICAgICB0aGlzLl9zZXRQYWdlRGF0YShkYXRhLnN0YXJ0SW5kZXgsIHRoaXMuX2dldE5yRGF0YShkYXRhLmRhdGEpKTtcbiAgICB9LFxuXG4gICAgX2NsZWFyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX2luZm8gPSBudWxsO1xuICAgICAgICBsZXQgaW5kZXhlcyA9IEFycmF5LmZyb20odGhpcy5faW5kZXhlcyk7XG4gICAgICAgIHRoaXMuX2luZGV4ZXMgPSBudWxsO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGluZGV4ZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHRoaXMuX3N0b3JhZ2UuZGVsKHRoaXMuX3BhZ2VLZXkoaW5kZXhlc1tpXS5zdGFydEluZGV4KSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgX2lzQ29tcGxldGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbGV0IGMgPSAwO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuX2luZGV4ZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGMgKz0gdGhpcy5faW5kZXhlc1tpXS5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGMgPiB0aGlzLl9pbmZvLmNvdW50KSB7XG4gICAgICAgICAgICB0aGlzLl9jbGVhcigpO1xuICAgICAgICAgICAgdGhyb3cgKFwiV3JvbmcgZGF0YSBsZW5ndGhcIik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGMgPT09IHRoaXMuX2luZm8uY291bnQ7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIHtcbiAgICAgKiAgICAgc3RhcnRIZWlnaHQ6MSxcbiAgICAgKiAgICAgZW5kSGVpZ2h0OjUwMCxcbiAgICAgKiAgICAgY291bnQ6MTAwMVxuICAgICAqICAgICBzdGFydEluZGV4OjAsXG4gICAgICogICAgIGRhdGE6W1wibjF4eHhcIl1cbiAgICAgKiB9XG4gICAgICovXG4gICAgcmVjZWl2ZTogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgbGV0IG5hbWUgPSBfY3ljbGVOYW1lKGRhdGEuc3RhcnRIZWlnaHQsIGRhdGEuZW5kSGVpZ2h0KTtcbiAgICAgICAgaWYgKHRoaXMuX25hbWUgIT09IG5hbWUpIHtcbiAgICAgICAgICAgIHRoaXMuX2NsZWFyKCk7XG4gICAgICAgICAgICB0aGlzLl9pbmZvID0ge1xuICAgICAgICAgICAgICAgIHN0YXJ0SGVpZ2h0OiBkYXRhLnN0YXJ0SGVpZ2h0LFxuICAgICAgICAgICAgICAgIGVuZEhlaWdodDogZGF0YS5lbmRIZWlnaHQsXG4gICAgICAgICAgICAgICAgY291bnQ6IHBhcnNlSW50KGRhdGEuY291bnQpLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9zYXZlRGF0YShkYXRhKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGxldCBjID0gdGhpcy5faXNDb21wbGV0ZSgpO1xuICAgICAgICAgICAgaWYgKGMpIHtcbiAgICAgICAgICAgICAgICBsZXQgciA9IHtcbiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkOiBjLFxuICAgICAgICAgICAgICAgICAgICBpbmZvOiB0aGlzLl9pbmZvLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB0aGlzLl9hbGxEYXRhXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB0aGlzLl9jbGVhcigpO1xuICAgICAgICAgICAgICAgIHJldHVybiByO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBjb21wbGV0ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBlcnJvcjogZVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufTtcblxuXG5mdW5jdGlvbiBDeWNsZURhdGEoc3RvcmFnZSwgY3ljbGUpIHtcbiAgICB0aGlzLl9zdG9yYWdlID0gc3RvcmFnZTtcbiAgICBsZXQgbmFtZSA9IF9jeWNsZU5hbWUoY3ljbGUuc3RhcnRIZWlnaHQsIGN5Y2xlLmVuZEhlaWdodCk7XG4gICAgdGhpcy5fcGFnZUxpc3QgPSBuZXcgTnJEYXRhTGlzdChzdG9yYWdlLCBuYW1lLCA0MDApO1xuICAgIHRoaXMuX2NvdW50S2V5ID0gbmFtZSArIFwiX2NvdW50XCI7XG59XG5cbkN5Y2xlRGF0YS5wcm90b3R5cGUgPSB7XG5cbiAgICBnZXQgY291bnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zdG9yYWdlLmdldCh0aGlzLl9jb3VudEtleSk7XG4gICAgfSxcblxuICAgIHNldCBjb3VudChjb3VudCkge1xuICAgICAgICB0aGlzLl9zdG9yYWdlLnB1dCh0aGlzLl9jb3VudEtleSwgY291bnQpO1xuICAgIH0sXG5cbiAgICBnZXQgcGFnZUNvdW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcGFnZUxpc3QuZ2V0UGFnZUluZGV4ZXMoKS5sZW5ndGg7XG4gICAgfSxcblxuICAgIHNldERhdGE6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHRoaXMuX3BhZ2VMaXN0LmNsZWFyKCk7XG4gICAgICAgIGxldCBuID0gTWF0aC5jZWlsKGRhdGEubGVuZ3RoIC8gcGFyc2VGbG9hdChcIlwiICsgdGhpcy5fcGFnZUxpc3QuX3BhZ2VTaXplKSk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgKytpKSB7XG4gICAgICAgICAgICBsZXQgZCA9IFtdO1xuICAgICAgICAgICAgZm9yIChsZXQgaiA9IGkgKiB0aGlzLl9wYWdlTGlzdC5fcGFnZVNpemU7IGogPCAoaSArIDEpICogdGhpcy5fcGFnZUxpc3QuX3BhZ2VTaXplOyArK2opIHtcbiAgICAgICAgICAgICAgICBpZiAoaiA+PSBkYXRhLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZC5wdXNoKGRhdGFbal0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fcGFnZUxpc3QuYWRkUGFnZShkKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNvdW50ID0gZGF0YS5sZW5ndGg7XG4gICAgfSxcblxuICAgIGdldFBhZ2VJbmRleGVzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9wYWdlTGlzdC5nZXRQYWdlSW5kZXhlcygpO1xuICAgIH0sXG5cbiAgICBnZXRQYWdlRGF0YTogZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICAgIGlmIChpbmRleCA+IHRoaXMucGFnZUNvdW50IC0gMSkge1xuICAgICAgICAgICAgdGhyb3cgKFwiaW5kZXggb3V0IG9mIHJhbmdlLlwiKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fcGFnZUxpc3QuZ2V0UGFnZURhdGEoaW5kZXgpO1xuICAgIH0sXG59O1xuXG5cbmZ1bmN0aW9uIEN5Y2xlTWFuYWdlcihzdG9yYWdlKSB7XG4gICAgdGhpcy5fc3RvcmFnZSA9IHN0b3JhZ2U7XG4gICAgdGhpcy5fcGFnZUxpc3QgPSBuZXcgTnJEYXRhTGlzdChzdG9yYWdlLCBcImN5Y2xlX2xpc3RcIiwgMTAwMCk7XG59XG5cbkN5Y2xlTWFuYWdlci5wcm90b3R5cGUgPSB7XG4gICAgX2NvbnRhaW5zOiBmdW5jdGlvbiAoY3ljbGUpIHtcbiAgICAgICAgbGV0IGluZGV4ZXMgPSB0aGlzLl9wYWdlTGlzdC5nZXRQYWdlSW5kZXhlcygpO1xuICAgICAgICBmb3IgKGxldCBpID0gaW5kZXhlcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgICAgICAgbGV0IGRzID0gdGhpcy5fcGFnZUxpc3QuZ2V0UGFnZURhdGEoaW5kZXhlc1tpXS5pKTtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSBkcy5sZW5ndGggLSAxOyBqID49IDA7IC0taikge1xuICAgICAgICAgICAgICAgIGxldCBkID0gZHNbal07XG4gICAgICAgICAgICAgICAgaWYgKGQuc3RhcnRIZWlnaHQgPT09IGN5Y2xlLnN0YXJ0SGVpZ2h0ICYmIGQuZW5kSGVpZ2h0ID09PSBjeWNsZS5lbmRIZWlnaHQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgYWRkQ3ljbGU6IGZ1bmN0aW9uIChjeWNsZSkge1xuICAgICAgICBpZiAoIXRoaXMuX2NvbnRhaW5zKGN5Y2xlKSkge1xuICAgICAgICAgICAgdGhpcy5fcGFnZUxpc3QuYWRkKGN5Y2xlKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBnZXRDeWNsZXM6IGZ1bmN0aW9uIChibG9jaykge1xuICAgICAgICBsZXQgciA9IFtdO1xuICAgICAgICBsZXQgaW5kZXhlcyA9IHRoaXMuX3BhZ2VMaXN0LmdldFBhZ2VJbmRleGVzKCk7XG4gICAgICAgIGZvciAobGV0IGkgPSBpbmRleGVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7XG4gICAgICAgICAgICBsZXQgZHMgPSB0aGlzLl9wYWdlTGlzdC5nZXRQYWdlRGF0YShpbmRleGVzW2ldLmkpO1xuICAgICAgICAgICAgZm9yIChsZXQgaiA9IGRzLmxlbmd0aCAtIDE7IGogPj0gMDsgLS1qKSB7XG4gICAgICAgICAgICAgICAgbGV0IGQgPSBkc1tqXTtcbiAgICAgICAgICAgICAgICBpZiAoZC5zdGFydEhlaWdodCA+IGJsb2NrKSB7XG4gICAgICAgICAgICAgICAgICAgIHIucHVzaChkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHI7XG4gICAgfSxcblxuICAgIGdldEN5Y2xlSW5kZXhlczogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcGFnZUxpc3QuZ2V0UGFnZUluZGV4ZXMoKTtcbiAgICB9LFxuXG4gICAgZ2V0Q3ljbGVzV2l0aEluZGV4OiBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3BhZ2VMaXN0LmdldFBhZ2VEYXRhKGluZGV4KTtcbiAgICB9XG59O1xuXG5cbmZ1bmN0aW9uIE5yRGF0YVNvdXJjZSgpIHtcbiAgICB0aGlzLl9jb250cmFjdE5hbWUgPSBcIk5yRGF0YVNvdXJjZVwiO1xuICAgIExvY2FsQ29udHJhY3RTdG9yYWdlLmRlZmluZVByb3BlcnRpZXModGhpcywge1xuICAgICAgICBfY29uZmlnOiBudWxsXG4gICAgfSk7XG4gICAgTG9jYWxDb250cmFjdFN0b3JhZ2UuZGVmaW5lTWFwUHJvcGVydHkodGhpcywgXCJfc3RvcmFnZVwiLCBudWxsKTtcbiAgICB0aGlzLl9yZWNlaXZlciA9IG5ldyBEYXRhUmVjZWl2ZXIodGhpcy5fc3RvcmFnZSk7XG4gICAgdGhpcy5fY3ljbGVNYW5hZ2VyID0gbmV3IEN5Y2xlTWFuYWdlcih0aGlzLl9zdG9yYWdlKTtcbn1cblxuTnJEYXRhU291cmNlLnByb3RvdHlwZSA9IHtcblxuICAgIF92ZXJpZnlBZGRyZXNzOiBmdW5jdGlvbiAoYWRkcmVzcykge1xuICAgICAgICBpZiAoQmxvY2tjaGFpbi52ZXJpZnlBZGRyZXNzKGFkZHJlc3MpID09PSAwKSB7XG4gICAgICAgICAgICB0aHJvdyAoXCJBZGRyZXNzIGVycm9yXCIpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIF92ZXJpZnlGcm9tTXVsdGlzaWc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuX2NvbmZpZy5tdWx0aVNpZyAhPT0gQmxvY2tjaGFpbi50cmFuc2FjdGlvbi5mcm9tKSB7XG4gICAgICAgICAgICB0aHJvdyAoXCJQZXJtaXNzaW9uIERlbmllZCFcIik7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgX3ZlcmlmeUZyb21NYW5hZ2VyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLl9jb25maWcubnJEYXRhTWFuYWdlciAhPT0gQmxvY2tjaGFpbi50cmFuc2FjdGlvbi5mcm9tKSB7XG4gICAgICAgICAgICB0aHJvdyAoXCJQZXJtaXNzaW9uIERlbmllZCFcIik7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgX3ZlcmlmeUNvbmZpZzogZnVuY3Rpb24gKGNvbmZpZykge1xuICAgICAgICB0aGlzLl92ZXJpZnlBZGRyZXNzKGNvbmZpZy5tdWx0aVNpZyk7XG4gICAgICAgIHRoaXMuX3ZlcmlmeUFkZHJlc3MoY29uZmlnLm5yRGF0YU1hbmFnZXIpO1xuICAgIH0sXG5cbiAgICBfZGlkUmVjZWl2ZURhdGE6IGZ1bmN0aW9uIChpbmZvLCBkYXRhKSB7XG4gICAgICAgIGxldCBjeWNsZSA9IHtzdGFydEhlaWdodDogaW5mby5zdGFydEhlaWdodCwgZW5kSGVpZ2h0OiBpbmZvLmVuZEhlaWdodH07XG4gICAgICAgIGxldCBjZCA9IG5ldyBDeWNsZURhdGEodGhpcy5fc3RvcmFnZSwgY3ljbGUpO1xuICAgICAgICBjZC5zZXREYXRhKGRhdGEpO1xuICAgICAgICB0aGlzLl9jeWNsZU1hbmFnZXIuYWRkQ3ljbGUoY3ljbGUpO1xuICAgIH0sXG5cbiAgICBpbml0OiBmdW5jdGlvbiAobXVsdGlTaWcpIHtcbiAgICAgICAgdGhpcy5fdmVyaWZ5QWRkcmVzcyhtdWx0aVNpZyk7XG4gICAgICAgIHRoaXMuX2NvbmZpZyA9IHttdWx0aVNpZzogbXVsdGlTaWd9O1xuICAgIH0sXG5cbiAgICBnZXRDb25maWc6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbmZpZztcbiAgICB9LFxuXG4gICAgc2V0Q29uZmlnOiBmdW5jdGlvbiAoY29uZmlnKSB7XG4gICAgICAgIHRoaXMuX3ZlcmlmeUNvbmZpZyhjb25maWcpO1xuICAgICAgICB0aGlzLl9jb25maWcgPSB7XG4gICAgICAgICAgICBtdWx0aVNpZzogY29uZmlnLm11bHRpU2lnLFxuICAgICAgICAgICAgbnJEYXRhTWFuYWdlcjogY29uZmlnLm5yRGF0YU1hbmFnZXJcbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgdXBsb2FkOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICB0aGlzLl92ZXJpZnlGcm9tTWFuYWdlcigpO1xuICAgICAgICBsZXQgciA9IHRoaXMuX3JlY2VpdmVyLnJlY2VpdmUoZGF0YSk7XG4gICAgICAgIGlmIChyLmVycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4gcjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoci5jb21wbGV0ZWQpIHtcbiAgICAgICAgICAgIHRoaXMuX2RpZFJlY2VpdmVEYXRhKHIuaW5mbywgci5kYXRhKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge2RhdGE6IHRydWV9O1xuICAgIH0sXG5cbiAgICBnZXROUjogZnVuY3Rpb24gKGJsb2NrLCBwYWdlSW5kZXgpIHtcbiAgICAgICAgbGV0IGN5Y2xlcyA9IHRoaXMuX2N5Y2xlTWFuYWdlci5nZXRDeWNsZXMoYmxvY2spO1xuICAgICAgICBpZiAoY3ljbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGxldCBjID0gY3ljbGVzW2N5Y2xlcy5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgIGxldCBjZCA9IG5ldyBDeWNsZURhdGEodGhpcy5fc3RvcmFnZSwgYyk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHNlY3Rpb246IGMsXG4gICAgICAgICAgICAgICAgaGFzTmV4dDogcGFnZUluZGV4IDwgY2QucGFnZUNvdW50IC0gMSxcbiAgICAgICAgICAgICAgICBkYXRhOiBjZC5nZXRQYWdlRGF0YShwYWdlSW5kZXgpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSxcblxuICAgIGdldEN5Y2xlSW5kZXhlczogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fY3ljbGVNYW5hZ2VyLmdldEN5Y2xlSW5kZXhlcygpO1xuICAgIH0sXG5cbiAgICBnZXRDeWNsZXM6IGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fY3ljbGVNYW5hZ2VyLmdldEN5Y2xlc1dpdGhJbmRleChpbmRleCk7XG4gICAgfSxcblxuICAgIGdldE5SSW5kZXhlc1dpdGhDeWNsZTogZnVuY3Rpb24gKHN0YXJ0SGVpZ2h0LCBlbmRIZWlnaHQpIHtcbiAgICAgICAgbGV0IGNkID0gbmV3IEN5Y2xlRGF0YSh0aGlzLl9zdG9yYWdlLCB7c3RhcnRIZWlnaHQ6IHN0YXJ0SGVpZ2h0LCBlbmRIZWlnaHQ6IGVuZEhlaWdodH0pO1xuICAgICAgICByZXR1cm4gY2QuZ2V0UGFnZUluZGV4ZXMoKTtcbiAgICB9LFxuXG4gICAgZ2V0TlJXaXRoQ3ljbGU6IGZ1bmN0aW9uIChzdGFydEhlaWdodCwgZW5kSGVpZ2h0LCBpbmRleCkge1xuICAgICAgICBsZXQgY2QgPSBuZXcgQ3ljbGVEYXRhKHRoaXMuX3N0b3JhZ2UsIHtzdGFydEhlaWdodDogc3RhcnRIZWlnaHQsIGVuZEhlaWdodDogZW5kSGVpZ2h0fSk7XG4gICAgICAgIHJldHVybiBjZC5nZXRQYWdlRGF0YShpbmRleCk7XG4gICAgfSxcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gTnJEYXRhU291cmNlO1xuIiwgIkFyZ3MiOiAiW1wibjFzeDJEVXBIb1d0c0dYcmh1cHVDQ3hVeGV1V2tZcnFWNWtcIl0ifUDXCEoQAAAAAAAAAAAAAAAEqBfIAFIQAAAAAAAAAAAAAAAAAAMNQFgBYkEtQK1eNzmcNIufIUc4x3u2hWBq6+yhX4ysFDUgkxYHkkqQ2C8zShMfd4roZBC+U/tV8HVneYOs1lp906AZJCU5AA==