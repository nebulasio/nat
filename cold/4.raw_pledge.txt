CiAcOIxjdmP3slbCzuS5W+Y3yO3vPgTMduLtKsdoBeuPSBIaGVcbjfHXBl0fnDap3sbXNtJSwGWxPjmxY9UaGhlXG43x1wZdH5w2qd7G1zbSUsBlsT45sWPVIhAAAAAAAAAAAAAAAAAAAAAAKD4w4LWA5qotOvKSAQoGZGVwbG95EuaSAXsiU291cmNlVHlwZSI6ICJqcyIsICJTb3VyY2UiOiAiLypcbiAgICBUaGlzIGlzIGEgc2ltcGxlIG11bHRpc2lnIHNtYXJ0IGNvbnRyYWN0LCBhbnkgY29zaWduZXIgaW4gdGhlIGxpc3Qgd2lsbCBiZSBhYmxlIHRvIGdldCB0aHJvdWdoIHRoZSBmdW5jdGlvbiBjYWxsXG4gICAgQGF1dGhvcjogWmh1b2VyIFdhbmcsIFBpbmcgR3VvLCBRaXl1YW4gV2FuZ1xuKi9cbmZ1bmN0aW9uIFBsZWRnZURhdGFMaXN0KHN0b3JhZ2UsIGtleSkge1xuICAgIHRoaXMuX3N0b3JhZ2UgPSBzdG9yYWdlO1xuICAgIHRoaXMuX2tleSA9IGtleTtcbiAgICB0aGlzLl9wYWdlSW5kZXhlcyA9IG51bGw7XG4gICAgdGhpcy5fcGFnZVNpemUgPSAxMDAwO1xufVxuXG5QbGVkZ2VEYXRhTGlzdC5wcm90b3R5cGUgPSB7XG5cbiAgICBfaW5kZXhlc0tleTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gXCJwaXNfXCIgKyB0aGlzLl9rZXk7XG4gICAgfSxcblxuICAgIF9kYXRhS2V5OiBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIFwicGRfXCIgKyB0aGlzLl9rZXkgKyBcIl9cIiArIGluZGV4O1xuICAgIH0sXG5cbiAgICBfbGFzdEluZGV4OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxldCBpbmRleGVzID0gdGhpcy5nZXRQYWdlSW5kZXhlcygpO1xuICAgICAgICBpZiAoaW5kZXhlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gaW5kZXhlc1tpbmRleGVzLmxlbmd0aCAtIDFdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH0sXG5cbiAgICBfYWRkSW5kZXg6IGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICB0aGlzLmdldFBhZ2VJbmRleGVzKCkucHVzaChpbmRleCk7XG4gICAgICAgIHRoaXMuX3NhdmVJbmRleGVzKCk7XG4gICAgfSxcblxuICAgIF9zYXZlSW5kZXhlczogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9zdG9yYWdlLnB1dCh0aGlzLl9pbmRleGVzS2V5KCksIHRoaXMuZ2V0UGFnZUluZGV4ZXMoKSk7XG4gICAgfSxcblxuICAgIF9zYXZlUGFnZURhdGE6IGZ1bmN0aW9uIChpbmRleCwgZGF0YSkge1xuICAgICAgICB0aGlzLl9zdG9yYWdlLnB1dCh0aGlzLl9kYXRhS2V5KGluZGV4KSwgZGF0YSk7XG4gICAgfSxcblxuICAgIGdldFBhZ2VJbmRleGVzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5fcGFnZUluZGV4ZXMpIHtcbiAgICAgICAgICAgIHRoaXMuX3BhZ2VJbmRleGVzID0gdGhpcy5fc3RvcmFnZS5nZXQodGhpcy5faW5kZXhlc0tleSgpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMuX3BhZ2VJbmRleGVzKSB7XG4gICAgICAgICAgICB0aGlzLl9wYWdlSW5kZXhlcyA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9wYWdlSW5kZXhlcztcbiAgICB9LFxuXG4gICAgZ2V0UGFnZURhdGE6IGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICBsZXQgciA9IHRoaXMuX3N0b3JhZ2UuZ2V0KHRoaXMuX2RhdGFLZXkoaW5kZXgpKTtcbiAgICAgICAgaWYgKCFyKSB7XG4gICAgICAgICAgICByID0gW107XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHI7XG4gICAgfSxcblxuICAgIGFkZEFsbDogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgbGV0IGluZGV4ZXMgPSB0aGlzLmdldFBhZ2VJbmRleGVzKCk7XG4gICAgICAgIGxldCB0ZW1wUGFnZURhdGEgPSBudWxsO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGxldCBvYmogPSBkYXRhW2ldO1xuICAgICAgICAgICAgbGV0IHAgPSBudWxsO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbmRleGVzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgbGV0IGluZGV4ID0gaW5kZXhlc1tpXTtcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXgubCA8IHRoaXMuX3BhZ2VTaXplKSB7XG4gICAgICAgICAgICAgICAgICAgIHAgPSBpbmRleDtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHAgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGxldCBpID0gMDtcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXhlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGkgPSBpbmRleGVzW2luZGV4ZXMubGVuZ3RoIC0gMV0uaSArIDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHAgPSB7aTogaSwgbDogMH07XG4gICAgICAgICAgICAgICAgaW5kZXhlcy5wdXNoKHApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGVtcFBhZ2VEYXRhICE9IG51bGwgJiYgdGVtcFBhZ2VEYXRhLmluZGV4ICE9PSBwLmkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9zdG9yYWdlLnB1dCh0aGlzLl9kYXRhS2V5KHRlbXBQYWdlRGF0YS5pbmRleCksIHRlbXBQYWdlRGF0YS5kYXRhKTtcbiAgICAgICAgICAgICAgICB0ZW1wUGFnZURhdGEgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCF0ZW1wUGFnZURhdGEpIHtcbiAgICAgICAgICAgICAgICB0ZW1wUGFnZURhdGEgPSB7aW5kZXg6IHAuaSwgZGF0YTogdGhpcy5nZXRQYWdlRGF0YShwLmkpfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBkID0gdGVtcFBhZ2VEYXRhLmRhdGE7XG4gICAgICAgICAgICBkLnB1c2gob2JqKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGVtcFBhZ2VEYXRhKSB7XG4gICAgICAgICAgICB0aGlzLl9zdG9yYWdlLnB1dCh0aGlzLl9kYXRhS2V5KHRlbXBQYWdlRGF0YS5pbmRleCksIHRlbXBQYWdlRGF0YS5kYXRhKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9zYXZlSW5kZXhlcygpO1xuICAgIH0sXG5cbiAgICBhZGQ6IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgbGV0IGluZGV4ZXMgPSB0aGlzLmdldFBhZ2VJbmRleGVzKCk7XG4gICAgICAgIGxldCBwID0gbnVsbDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbmRleGVzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBsZXQgaW5kZXggPSBpbmRleGVzW2ldO1xuICAgICAgICAgICAgaWYgKGluZGV4LmwgPCB0aGlzLl9wYWdlU2l6ZSkge1xuICAgICAgICAgICAgICAgIHAgPSBpbmRleDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwID09IG51bGwpIHtcbiAgICAgICAgICAgIGxldCBpID0gMDtcbiAgICAgICAgICAgIGlmIChpbmRleGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBpID0gaW5kZXhlc1tpbmRleGVzLmxlbmd0aCAtIDFdLmkgKyAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcCA9IHtpOiBpLCBsOiAwfTtcbiAgICAgICAgICAgIHRoaXMuX2FkZEluZGV4KHApO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGQgPSB0aGlzLmdldFBhZ2VEYXRhKHAuaSk7XG4gICAgICAgIGQucHVzaChvYmopO1xuICAgICAgICBwLmwgKz0gMTtcbiAgICAgICAgdGhpcy5fc2F2ZUluZGV4ZXMoKTtcbiAgICAgICAgdGhpcy5fc3RvcmFnZS5wdXQodGhpcy5fZGF0YUtleShwLmkpLCBkKTtcbiAgICB9LFxuXG4gICAgZGVsOiBmdW5jdGlvbiAoZWxlKSB7XG4gICAgICAgIGxldCBpbmRleGVzID0gdGhpcy5nZXRQYWdlSW5kZXhlcygpO1xuICAgICAgICBpZiAoaW5kZXhlcykge1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbmRleGVzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgbGV0IGluZGV4ID0gaW5kZXhlc1tpXTtcbiAgICAgICAgICAgICAgICBsZXQgZHMgPSB0aGlzLmdldFBhZ2VEYXRhKGluZGV4LmkpO1xuICAgICAgICAgICAgICAgIGlmIChkcykge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGRzLmxlbmd0aDsgKytqKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWxlID09PSBkc1tqXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRzLnNwbGljZShqLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRleC5sIC09IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc3RvcmFnZS5wdXQodGhpcy5fZGF0YUtleShpbmRleC5pKSwgZHMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3N0b3JhZ2UucHV0KHRoaXMuX2luZGV4ZXNLZXkoKSwgaW5kZXhlcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG5cbiAgICBkZWxBbGw6IGZ1bmN0aW9uIChlbGVzKSB7XG4gICAgICAgIGxldCBpbmRleGVzID0gdGhpcy5nZXRQYWdlSW5kZXhlcygpO1xuICAgICAgICBpZiAoaW5kZXhlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgY2FjaGVQYWdlcyA9IHt9O1xuICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IGVsZXMubGVuZ3RoOyArK2spIHtcbiAgICAgICAgICAgIGxldCBlbGUgPSBlbGVzW2tdO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbmRleGVzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgbGV0IGluZGV4ID0gaW5kZXhlc1tpXTtcbiAgICAgICAgICAgICAgICBsZXQgc3RySW5kZXggPSBcIlwiICsgaW5kZXguaTtcbiAgICAgICAgICAgICAgICBsZXQgcCA9IGNhY2hlUGFnZXNbc3RySW5kZXhdO1xuICAgICAgICAgICAgICAgIGlmICghcCkge1xuICAgICAgICAgICAgICAgICAgICBwID0ge2NoYW5nZWQ6IGZhbHNlLCBkYXRhOiB0aGlzLmdldFBhZ2VEYXRhKGluZGV4LmkpfTtcbiAgICAgICAgICAgICAgICAgICAgY2FjaGVQYWdlc1tzdHJJbmRleF0gPSBwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBsZXQgbmV3RGF0YSA9IFtdO1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgcC5kYXRhLmxlbmd0aDsgKytqKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlbGUgIT09IHAuZGF0YVtqXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3RGF0YS5wdXNoKHAuZGF0YVtqXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG5ld0RhdGEubGVuZ3RoICE9PSBwLmRhdGEubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHAuY2hhbmdlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHAuZGF0YSA9IG5ld0RhdGE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZvciAobGV0IGluZGV4IGluIGNhY2hlUGFnZXMpIHtcbiAgICAgICAgICAgIGxldCBwID0gY2FjaGVQYWdlc1tpbmRleF07XG4gICAgICAgICAgICBpZiAocC5jaGFuZ2VkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fc2F2ZVBhZ2VEYXRhKGluZGV4LCBwLmRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3NhdmVJbmRleGVzKCk7XG4gICAgfVxufTtcblxuXG5mdW5jdGlvbiBDdXJyZW50RGF0YShzdG9yYWdlKSB7XG4gICAgdGhpcy5fc3RvcmFnZSA9IHN0b3JhZ2U7XG4gICAgdGhpcy5fYWRkcmVzc0xpc3QgPSBuZXcgUGxlZGdlRGF0YUxpc3Qoc3RvcmFnZSwgXCJhZGRyZXNzX2xpc3RcIik7XG5cbiAgICB0aGlzLl9wYWdlU2l6ZSA9IDQwMDtcbiAgICB0aGlzLl9rZXlMYXN0QmxvY2sgPSBcImxhc3RfYmxvY2tcIjtcbiAgICB0aGlzLl9sYXN0QmxvY2sgPSBudWxsO1xufVxuXG5DdXJyZW50RGF0YS5wcm90b3R5cGUgPSB7XG5cbiAgICBfZ2V0UGxlZGdlczogZnVuY3Rpb24gKGFkZHJlc3MpIHtcbiAgICAgICAgbGV0IHIgPSB0aGlzLl9zdG9yYWdlLmdldChhZGRyZXNzKTtcbiAgICAgICAgaWYgKCFyKSB7XG4gICAgICAgICAgICByID0gW107XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHI7XG4gICAgfSxcblxuICAgIF9jYW5QbGVkZ2U6IGZ1bmN0aW9uIChhZGRyZXNzKSB7XG4gICAgICAgIGxldCBwcyA9IHRoaXMuX2dldFBsZWRnZXMoYWRkcmVzcyk7XG4gICAgICAgIGlmIChwcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwc1twcy5sZW5ndGggLSAxXS5lICE9IG51bGw7XG4gICAgfSxcblxuICAgIF9jYW5EZWxldGU6IGZ1bmN0aW9uIChwbGVkZ2UpIHtcbiAgICAgICAgbGV0IGxhc3RCbG9jayA9IHRoaXMubGFzdEJsb2NrO1xuICAgICAgICByZXR1cm4gbGFzdEJsb2NrICYmIHBsZWRnZS5lICYmIGxhc3RCbG9jayA+IHBsZWRnZS5lO1xuICAgIH0sXG5cbiAgICBfZ2V0UGxlZGdlOiBmdW5jdGlvbiAoYWRkcmVzcywgc3RhcnRCbG9jaywgZW5kQmxvY2spIHtcbiAgICAgICAgbGV0IHBzID0gdGhpcy5fZ2V0UGxlZGdlcyhhZGRyZXNzKTtcbiAgICAgICAgaWYgKHBzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgbGV0IHAgPSBwc1tpXTtcbiAgICAgICAgICAgIGlmIChwLnMgPD0gc3RhcnRCbG9jayAmJiAoIXAuZSB8fCBwLmUgPj0gZW5kQmxvY2spKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSxcblxuICAgIF9jaGVja0FuZERlbGV0ZTogZnVuY3Rpb24gKGFkZHJlc3MpIHtcbiAgICAgICAgbGV0IHBzID0gdGhpcy5fZ2V0UGxlZGdlcyhhZGRyZXNzKTtcbiAgICAgICAgaWYgKHBzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGxldCBuZXdQcyA9IFtdO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBsZXQgcCA9IHBzW2ldO1xuICAgICAgICAgICAgaWYgKCF0aGlzLl9jYW5EZWxldGUocCkpIHtcbiAgICAgICAgICAgICAgICBuZXdQcy5wdXNoKHApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChuZXdQcy5sZW5ndGggPiAwICYmIG5ld1BzLmxlbmd0aCAhPT0gcHMubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLl9zdG9yYWdlLnB1dChhZGRyZXNzLCBuZXdQcyk7XG4gICAgICAgIH0gZWxzZSBpZiAobmV3UHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLl9zdG9yYWdlLmRlbChhZGRyZXNzKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuXG4gICAgX2dldFBhZ2VQbGVkZ2VzOiBmdW5jdGlvbiAocGxlZGdlcywgcGFnZU51bSkge1xuICAgICAgICBpZiAoIXBsZWRnZXMgfHwgcGxlZGdlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGxldCBwYWdlQ291bnQgPSBNYXRoLmNlaWwocGxlZGdlcy5sZW5ndGggLyBwYXJzZUZsb2F0KFwiXCIgKyB0aGlzLl9wYWdlU2l6ZSkpO1xuICAgICAgICBpZiAocGFnZU51bSA+IHBhZ2VDb3VudCAtIDEpIHtcbiAgICAgICAgICAgIHRocm93IChcInBhZ2VOdW0gb3V0IG9mIHJhbmdlLlwiKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgciA9IFtdO1xuICAgICAgICBmb3IgKGxldCBpID0gcGFnZU51bSAqIHRoaXMuX3BhZ2VTaXplOyBpIDwgKHBhZ2VOdW0gKyAxKSAqIHRoaXMuX3BhZ2VTaXplOyArK2kpIHtcbiAgICAgICAgICAgIGlmIChpID4gcGxlZGdlcy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByLnB1c2gocGxlZGdlc1tpXSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtoYXNOZXh0OiBwYWdlTnVtIDwgcGFnZUNvdW50IC0gMSwgZGF0YTogcn07XG4gICAgfSxcblxuICAgIGdldCBsYXN0QmxvY2soKSB7XG4gICAgICAgIGlmICghdGhpcy5fbGFzdEJsb2NrKSB7XG4gICAgICAgICAgICB0aGlzLl9sYXN0QmxvY2sgPSB0aGlzLl9zdG9yYWdlLmdldCh0aGlzLl9rZXlMYXN0QmxvY2spO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9sYXN0QmxvY2s7XG4gICAgfSxcblxuICAgIHNldCBsYXN0QmxvY2soYmxvY2spIHtcbiAgICAgICAgdGhpcy5fbGFzdEJsb2NrID0gYmxvY2s7XG4gICAgICAgIHRoaXMuX3N0b3JhZ2UucHV0KHRoaXMuX2tleUxhc3RCbG9jaywgYmxvY2spO1xuICAgIH0sXG5cbiAgICBjaGVja0FuZERlbGV0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICBsZXQgYXMgPSBbXTtcbiAgICAgICAgbGV0IGluZGV4ZXMgPSBBcnJheS5mcm9tKHRoaXMuX2FkZHJlc3NMaXN0LmdldFBhZ2VJbmRleGVzKCkpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGluZGV4ZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGxldCBpbmRleCA9IGluZGV4ZXNbaV07XG4gICAgICAgICAgICBsZXQgYXMgPSBBcnJheS5mcm9tKHRoaXMuX2FkZHJlc3NMaXN0LmdldFBhZ2VEYXRhKGluZGV4LmkpKTtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgYXMubGVuZ3RoOyArK2opIHtcbiAgICAgICAgICAgICAgICBsZXQgYSA9IGFzW2pdO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jaGVja0FuZERlbGV0ZShhKSkge1xuICAgICAgICAgICAgICAgICAgICBhcy5wdXNoKGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoYXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdGhpcy5fYWRkcmVzc0xpc3QuZGVsQWxsKGFkZHJlc3MpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldERpc3RyaWJ1dGVQbGVkZ2VzOiBmdW5jdGlvbiAoc3RhcnRCbG9jaywgZW5kQmxvY2ssIHBhZ2VOdW0pIHtcbiAgICAgICAgbGV0IHIgPSBbXTtcbiAgICAgICAgbGV0IGluZGV4ZXMgPSB0aGlzLl9hZGRyZXNzTGlzdC5nZXRQYWdlSW5kZXhlcygpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGluZGV4ZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGxldCBpbmRleCA9IGluZGV4ZXNbaV07XG4gICAgICAgICAgICBsZXQgYXMgPSB0aGlzLl9hZGRyZXNzTGlzdC5nZXRQYWdlRGF0YShpbmRleC5pKTtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgYXMubGVuZ3RoOyArK2opIHtcbiAgICAgICAgICAgICAgICBsZXQgYSA9IGFzW2pdO1xuICAgICAgICAgICAgICAgIGxldCBwID0gdGhpcy5fZ2V0UGxlZGdlKGEsIHN0YXJ0QmxvY2ssIGVuZEJsb2NrKTtcbiAgICAgICAgICAgICAgICBpZiAocCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHIucHVzaCh7YWRkcjogYSwgdmFsdWU6IHAudn0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fZ2V0UGFnZVBsZWRnZXMociwgcGFnZU51bSk7XG4gICAgfSxcblxuICAgIGFkZFBsZWRnZTogZnVuY3Rpb24gKGFkZHJlc3MsIHBsZWRnZSkge1xuICAgICAgICBpZiAoIXRoaXMuX2NhblBsZWRnZShhZGRyZXNzKSkge1xuICAgICAgICAgICAgdGhyb3cgKFwiWW91IGFscmVhZHkgaGF2ZSBhIHBsZWRnZS5cIik7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHBzID0gdGhpcy5fZ2V0UGxlZGdlcyhhZGRyZXNzKTtcbiAgICAgICAgaWYgKHBzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgdGhpcy5fYWRkcmVzc0xpc3QuYWRkKGFkZHJlc3MpO1xuICAgICAgICB9XG4gICAgICAgIHBzLnB1c2gocGxlZGdlKTtcbiAgICAgICAgdGhpcy5fc3RvcmFnZS5wdXQoYWRkcmVzcywgcHMpO1xuICAgIH0sXG5cbiAgICBhZGRBbGxQbGVkZ2U6IGZ1bmN0aW9uIChwbGVkZ2VzLCBhZGRyZXNzZXMpIHtcbiAgICAgICAgdGhpcy5fYWRkcmVzc0xpc3QuYWRkQWxsKGFkZHJlc3Nlcyk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGxlZGdlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgdGhpcy5fc3RvcmFnZS5wdXQocGxlZGdlc1tpXS5hLCBbcGxlZGdlc1tpXS5wXSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgY2FuY2VsUGxlZGdlOiBmdW5jdGlvbiAoYWRkcmVzcykge1xuICAgICAgICBpZiAodGhpcy5fY2FuUGxlZGdlKGFkZHJlc3MpKSB7XG4gICAgICAgICAgICB0aHJvdyAoXCJObyBwbGVkZ2VzIHRoYXQgY2FuIGJlIGNhbmNlbGxlZC5cIik7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHBzID0gdGhpcy5fZ2V0UGxlZGdlcyhhZGRyZXNzKTtcbiAgICAgICAgbGV0IHAgPSBwc1twcy5sZW5ndGggLSAxXTtcbiAgICAgICAgcC5lID0gQmxvY2tjaGFpbi5ibG9jay5oZWlnaHQ7XG4gICAgICAgIHRoaXMuX3N0b3JhZ2UucHV0KGFkZHJlc3MsIHBzKTtcbiAgICAgICAgcmV0dXJuIHA7XG4gICAgfSxcblxuICAgIGdldEN1cnJlbnRQbGVkZ2VzOiBmdW5jdGlvbiAoYWRkcmVzcykge1xuICAgICAgICBsZXQgciA9IHRoaXMuX3N0b3JhZ2UuZ2V0KGFkZHJlc3MpO1xuICAgICAgICBpZiAoIXIpIHtcbiAgICAgICAgICAgIHIgPSBbXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcjtcbiAgICB9XG59O1xuXG5cbmZ1bmN0aW9uIEhpc3RvcnlEYXRhKHN0b3JhZ2UpIHtcbiAgICB0aGlzLl9zdG9yYWdlID0gc3RvcmFnZTtcbiAgICB0aGlzLl9hZGRyZXNzTGlzdCA9IG5ldyBQbGVkZ2VEYXRhTGlzdChzdG9yYWdlLCBcImFkZHJlc3NfbGlzdFwiKTtcbn1cblxuSGlzdG9yeURhdGEucHJvdG90eXBlID0ge1xuXG4gICAgX2FkZHJlc3NIaXN0b3J5RGF0YTogZnVuY3Rpb24gKGFkZHJlc3MpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQbGVkZ2VEYXRhTGlzdCh0aGlzLl9zdG9yYWdlLCBcImhfXCIgKyBhZGRyZXNzKTtcbiAgICB9LFxuXG4gICAgYWRkUGxlZGdlOiBmdW5jdGlvbiAoYWRkcmVzcywgcGxlZGdlKSB7XG4gICAgICAgIGxldCBhZCA9IHRoaXMuX2FkZHJlc3NIaXN0b3J5RGF0YShhZGRyZXNzKTtcbiAgICAgICAgaWYgKGFkLmdldFBhZ2VJbmRleGVzKCkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLl9hZGRyZXNzTGlzdC5hZGQoYWRkcmVzcyk7XG4gICAgICAgIH1cbiAgICAgICAgYWQuYWRkKHBsZWRnZSk7XG4gICAgfSxcblxuICAgIGdldEhpc3RvcnlQbGVkZ2VJbmRleGVzOiBmdW5jdGlvbiAoYWRkcmVzcykge1xuICAgICAgICByZXR1cm4gdGhpcy5fYWRkcmVzc0hpc3RvcnlEYXRhKGFkZHJlc3MpLmdldFBhZ2VJbmRleGVzKCk7XG4gICAgfSxcblxuICAgIGdldEhpc3RvcnlQbGVkZ2VzOiBmdW5jdGlvbiAoYWRkcmVzcywgaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2FkZHJlc3NIaXN0b3J5RGF0YShhZGRyZXNzKS5nZXRQYWdlRGF0YShpbmRleCk7XG4gICAgfSxcbn07XG5cblxuZnVuY3Rpb24gRGlzdHJpYnV0ZURhdGEoc3RvcmFnZSkge1xuICAgIHRoaXMuX3N0b3JhZ2UgPSBzdG9yYWdlO1xuICAgIHRoaXMuX2FkZHJlc3NMaXN0ID0gbmV3IFBsZWRnZURhdGFMaXN0KHN0b3JhZ2UsIFwiYWRkcmVzc19saXN0XCIpO1xufVxuXG5EaXN0cmlidXRlRGF0YS5wcm90b3R5cGUgPSB7XG5cbiAgICBfYWRkcmVzc0RhdGE6IGZ1bmN0aW9uIChhZGRyZXNzKSB7XG4gICAgICAgIHJldHVybiBuZXcgUGxlZGdlRGF0YUxpc3QodGhpcy5fc3RvcmFnZSwgXCJkX1wiICsgYWRkcmVzcyk7XG4gICAgfSxcblxuICAgIGFkZERpc3RyaWJ1dGU6IGZ1bmN0aW9uIChhZGRyZXNzLCBkaXN0cmlidXRlKSB7XG4gICAgICAgIGxldCBhZCA9IHRoaXMuX2FkZHJlc3NEYXRhKGFkZHJlc3MpO1xuICAgICAgICBpZiAoYWQuZ2V0UGFnZUluZGV4ZXMoKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMuX2FkZHJlc3NMaXN0LmFkZChhZGRyZXNzKTtcbiAgICAgICAgfVxuICAgICAgICBhZC5hZGQoZGlzdHJpYnV0ZSk7XG4gICAgfSxcblxuICAgIGdldERpc3RyaWJ1dGVJbmRleGVzOiBmdW5jdGlvbiAoYWRkcmVzcykge1xuICAgICAgICByZXR1cm4gdGhpcy5fYWRkcmVzc0RhdGEoYWRkcmVzcykuZ2V0UGFnZUluZGV4ZXMoKTtcbiAgICB9LFxuXG4gICAgZ2V0RGlzdHJpYnV0ZXM6IGZ1bmN0aW9uIChhZGRyZXNzLCBpbmRleCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYWRkcmVzc0RhdGEoYWRkcmVzcykuZ2V0UGFnZURhdGEoaW5kZXgpO1xuICAgIH0sXG59O1xuXG5cbmZ1bmN0aW9uIFN0YXRpc3RpY0RhdGEoc3RvcmFnZSkge1xuICAgIHRoaXMuX3N0b3JhZ2UgPSBzdG9yYWdlO1xuICAgIHRoaXMuX2FkZHJlc3NMaXN0ID0gbmV3IFBsZWRnZURhdGFMaXN0KHN0b3JhZ2UsIFwiYWRkcmVzc19saXN0XCIpO1xufVxuXG5TdGF0aXN0aWNEYXRhLnByb3RvdHlwZSA9IHtcblxuICAgIGFkZEFsbEFkZHJlc3M6IGZ1bmN0aW9uIChhZGRyZXNzZXMpIHtcbiAgICAgICAgdGhpcy5fYWRkcmVzc0xpc3QuYWRkQWxsKGFkZHJlc3Nlcyk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWRkcmVzc2VzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB0aGlzLl9zdG9yYWdlLnB1dChhZGRyZXNzZXNbaV0sIHtuYXQ6IFwiMFwifSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgYWRkQWRkcmVzczogZnVuY3Rpb24gKGFkZHJlc3MpIHtcbiAgICAgICAgbGV0IGQgPSB0aGlzLl9zdG9yYWdlLmdldChhZGRyZXNzKTtcbiAgICAgICAgaWYgKCFkKSB7XG4gICAgICAgICAgICB0aGlzLl9hZGRyZXNzTGlzdC5hZGQoYWRkcmVzcyk7XG4gICAgICAgICAgICB0aGlzLl9zdG9yYWdlLnB1dChhZGRyZXNzLCB7bmF0OiBcIjBcIn0pO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGFkZE5hdDogZnVuY3Rpb24gKGFkZHJlc3MsIG5hdCkge1xuICAgICAgICBsZXQgZCA9IHRoaXMuX3N0b3JhZ2UuZ2V0KGFkZHJlc3MpO1xuICAgICAgICBpZiAoIWQpIHtcbiAgICAgICAgICAgIGQgPSB7bmF0OiBcIjBcIn07XG4gICAgICAgIH1cbiAgICAgICAgZC5uYXQgPSBuZXcgQmlnTnVtYmVyKGQubmF0KS5wbHVzKG5ldyBCaWdOdW1iZXIobmF0KSkudG9TdHJpbmcoMTApO1xuICAgICAgICB0aGlzLl9zdG9yYWdlLnB1dChhZGRyZXNzLCBkKTtcbiAgICB9LFxuXG4gICAgZ2V0TmF0OiBmdW5jdGlvbiAoYWRkcmVzcykge1xuICAgICAgICBsZXQgZCA9IHRoaXMuX3N0b3JhZ2UuZ2V0KGFkZHJlc3MpO1xuICAgICAgICBpZiAoZCkge1xuICAgICAgICAgICAgcmV0dXJuIGQubmF0O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBcIjBcIjtcbiAgICB9XG59O1xuXG5cbmZ1bmN0aW9uIFBsZWRnZSgpIHtcbiAgICB0aGlzLl9jb250cmFjdE5hbWUgPSBcIlBsZWRnZVwiO1xuICAgIExvY2FsQ29udHJhY3RTdG9yYWdlLmRlZmluZVByb3BlcnRpZXModGhpcywge1xuICAgICAgICBfY29uZmlnOiBudWxsLFxuICAgIH0pO1xuICAgIExvY2FsQ29udHJhY3RTdG9yYWdlLmRlZmluZU1hcFByb3BlcnRpZXModGhpcywge1xuICAgICAgICBcIl9zdG9yYWdlXCI6IG51bGwsXG4gICAgICAgIFwiX2N1cnJlbnRcIjogbnVsbCxcbiAgICAgICAgXCJfaGlzdG9yaWVzXCI6IG51bGwsXG4gICAgICAgIFwiX2Rpc3RyaWJ1dGVzXCI6IG51bGwsXG4gICAgfSk7XG5cbiAgICAvLyB0aGlzLl9QUkVWX1BMRURHRSA9IFwibjFuNUZjdGtqeDJwQTdpTFg4cmdSeUNhN1ZLaW5HRk5lOUhcIjtcbiAgICB0aGlzLl9QUkVWX1BMRURHRSA9IFwibjFoNkx1RWhMNlBKR25NMk44VUFoa1QzVEdIZkRtbXh2c0pcIjtcblxuICAgIHRoaXMuX3N0YXRpc3RpY0RhdGEgPSBuZXcgU3RhdGlzdGljRGF0YSh0aGlzLl9zdG9yYWdlKTtcbiAgICB0aGlzLl9jdXJyZW50RGF0YSA9IG5ldyBDdXJyZW50RGF0YSh0aGlzLl9jdXJyZW50KTtcbiAgICB0aGlzLl9oaXN0b3J5RGF0YSA9IG5ldyBIaXN0b3J5RGF0YSh0aGlzLl9oaXN0b3JpZXMpO1xuICAgIHRoaXMuX2Rpc3RyaWJ1dGVEYXRhID0gbmV3IERpc3RyaWJ1dGVEYXRhKHRoaXMuX2Rpc3RyaWJ1dGVzKTtcblxuICAgIHRoaXMuX3VuaXQgPSBuZXcgQmlnTnVtYmVyKDEwKS5wb3coMTgpO1xufVxuXG5QbGVkZ2UucHJvdG90eXBlID0ge1xuXG4gICAgaW5pdDogZnVuY3Rpb24gKG11bHRpU2lnQWRkcmVzcykge1xuICAgICAgICB0aGlzLl92ZXJpZnlBZGRyZXNzKG11bHRpU2lnQWRkcmVzcyk7XG4gICAgICAgIHRoaXMuX2NvbmZpZyA9IHttdWx0aVNpZzogbXVsdGlTaWdBZGRyZXNzfTtcbiAgICB9LFxuXG4gICAgX3ZlcmlmeUFkZHJlc3M6IGZ1bmN0aW9uIChhZGRyZXNzKSB7XG4gICAgICAgIGlmIChCbG9ja2NoYWluLnZlcmlmeUFkZHJlc3MoYWRkcmVzcykgPT09IDApIHtcbiAgICAgICAgICAgIHRocm93IChcIkFkZHJlc3MgZXJyb3JcIik7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgX3ZlcmlmeUZyb21NdWx0aXNpZzogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fY29uZmlnLm11bHRpU2lnICE9PSBCbG9ja2NoYWluLnRyYW5zYWN0aW9uLmZyb20pIHtcbiAgICAgICAgICAgIHRocm93IChcIlBlcm1pc3Npb24gRGVuaWVkIVwiKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBfdmVyaWZ5RnJvbVBsZWRnZVByb3h5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLl9jb25maWcucGxlZGdlUHJveHkgIT09IEJsb2NrY2hhaW4udHJhbnNhY3Rpb24uZnJvbSkge1xuICAgICAgICAgICAgdGhyb3cgKFwiUGVybWlzc2lvbiBEZW5pZWQhXCIpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIF92ZXJpZnlGcm9tUHJldlBsZWRnZTogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fUFJFVl9QTEVER0UgIT09IEJsb2NrY2hhaW4udHJhbnNhY3Rpb24uZnJvbSkge1xuICAgICAgICAgICAgdGhyb3cgKFwiUGVybWlzc2lvbiBEZW5pZWQhXCIpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIF92ZXJpZnlGcm9tRGlzdHJpYnV0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fY29uZmlnLmRpc3RyaWJ1dGUgIT09IEJsb2NrY2hhaW4udHJhbnNhY3Rpb24uZnJvbSkge1xuICAgICAgICAgICAgdGhyb3cgKFwiUGVybWlzc2lvbiBEZW5pZWQhXCIpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldENvbmZpZzogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fY29uZmlnO1xuICAgIH0sXG5cbiAgICBzZXRDb25maWc6IGZ1bmN0aW9uIChjb25maWcpIHtcbiAgICAgICAgdGhpcy5fdmVyaWZ5RnJvbU11bHRpc2lnKCk7XG4gICAgICAgIHRoaXMuX2NvbmZpZyA9IHtcbiAgICAgICAgICAgIG11bHRpU2lnOiBjb25maWcubXVsdGlTaWcsXG4gICAgICAgICAgICBwbGVkZ2VQcm94eTogY29uZmlnLnBsZWRnZVByb3h5LFxuICAgICAgICAgICAgZGlzdHJpYnV0ZTogY29uZmlnLmRpc3RyaWJ1dGVcbiAgICAgICAgfTtcbiAgICB9LFxuXG4gICAgLy8gZm9yIHBsZWRnZV9wcm94eS5qcyBvbmx5XG4gICAgcGxlZGdlOiBmdW5jdGlvbiAoYWRkcmVzcywgdmFsdWUpIHtcbiAgICAgICAgdGhpcy5fdmVyaWZ5RnJvbVBsZWRnZVByb3h5KCk7XG4gICAgICAgIHZhbHVlID0gbmV3IEJpZ051bWJlcih2YWx1ZSk7XG4gICAgICAgIGlmIChuZXcgQmlnTnVtYmVyKDUpLm11bCh0aGlzLl91bml0KS5ndCh2YWx1ZSkpIHtcbiAgICAgICAgICAgIHRocm93IChcIlRoZSBhbW91bnQgY2Fubm90IGJlIGxlc3MgdGhhbiA1IE5BU1wiKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgaCA9IEJsb2NrY2hhaW4uYmxvY2suaGVpZ2h0O1xuICAgICAgICBsZXQgdiA9IHZhbHVlLmRpdih0aGlzLl91bml0KS50b1N0cmluZygxMCk7XG4gICAgICAgIHRoaXMuX2N1cnJlbnREYXRhLmFkZFBsZWRnZShhZGRyZXNzLCB7czogaCwgdjogdiwgZTogbnVsbH0pO1xuICAgICAgICB0aGlzLl9zdGF0aXN0aWNEYXRhLmFkZEFkZHJlc3MoYWRkcmVzcyk7XG4gICAgfSxcblxuICAgIC8vIGZvciBwbGVkZ2VfcHJveHkuanMgb25seVxuICAgIGNhbmNlbFBsZWRnZTogZnVuY3Rpb24gKGFkZHJlc3MpIHtcbiAgICAgICAgdGhpcy5fdmVyaWZ5RnJvbVBsZWRnZVByb3h5KCk7XG4gICAgICAgIGxldCBwID0gdGhpcy5fY3VycmVudERhdGEuY2FuY2VsUGxlZGdlKGFkZHJlc3MpO1xuICAgICAgICB0aGlzLl9oaXN0b3J5RGF0YS5hZGRQbGVkZ2UoYWRkcmVzcywgcCk7XG4gICAgICAgIHJldHVybiBuZXcgQmlnTnVtYmVyKHAudikubXVsKG5ldyBCaWdOdW1iZXIoMTApLnBvdygxOCkpO1xuICAgIH0sXG5cbiAgICByZWNlaXZlUGxlZGdlRGF0YTogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgdGhpcy5fdmVyaWZ5RnJvbVByZXZQbGVkZ2UoKTtcbiAgICAgICAgbGV0IHBzID0gW107XG4gICAgICAgIGxldCBhcyA9IFtdO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGxldCBhID0gZGF0YVtpXS5hO1xuICAgICAgICAgICAgbGV0IHAgPSBkYXRhW2ldLnA7XG4gICAgICAgICAgICBpZiAocC5jKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwcy5wdXNoKHthOiBhLCBwOiB7czogcC5iLCB2OiBwLnYsIGU6IG51bGx9fSk7XG4gICAgICAgICAgICBhcy5wdXNoKGEpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2N1cnJlbnREYXRhLmFkZEFsbFBsZWRnZShwcywgYXMpO1xuICAgICAgICB0aGlzLl9zdGF0aXN0aWNEYXRhLmFkZEFsbEFkZHJlc3MoYXMpO1xuICAgIH0sXG5cbiAgICAvLyBmb3IgZGlzdHJpYnV0ZS5qc1xuICAgIGdldFBsZWRnZTogZnVuY3Rpb24gKHN0YXJ0QmxvY2ssIGVuZEJsb2NrLCBwYWdlTnVtKSB7XG4gICAgICAgIHRoaXMuX3ZlcmlmeUZyb21EaXN0cmlidXRlKCk7XG4gICAgICAgIHJldHVybiB0aGlzLl9jdXJyZW50RGF0YS5nZXREaXN0cmlidXRlUGxlZGdlcyhzdGFydEJsb2NrLCBlbmRCbG9jaywgcGFnZU51bSk7XG4gICAgfSxcblxuICAgIC8vIGZvciBkaXN0cmlidXRlLmpzXG4gICAgc2V0UGxlZGdlUmVzdWx0OiBmdW5jdGlvbiAoc3RhcnRCbG9jaywgZW5kQmxvY2ssIGRhdGEpIHtcbiAgICAgICAgdGhpcy5fdmVyaWZ5RnJvbURpc3RyaWJ1dGUoKTtcbiAgICAgICAgdGhpcy5fY3VycmVudERhdGEubGFzdEJsb2NrID0gZW5kQmxvY2s7XG4gICAgICAgIHRoaXMuX2N1cnJlbnREYXRhLmNoZWNrQW5kRGVsZXRlKCk7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBsZXQgZCA9IGRhdGFbaV07XG4gICAgICAgICAgICB0aGlzLl9zdGF0aXN0aWNEYXRhLmFkZE5hdChkLmFkZHIsIGQubmF0KTtcbiAgICAgICAgICAgIHRoaXMuX2Rpc3RyaWJ1dGVEYXRhLmFkZERpc3RyaWJ1dGUoZC5hZGRyLCB7djogZC52YWx1ZSwgZDogZC5uYXQsIHM6IHN0YXJ0QmxvY2ssIGU6IGVuZEJsb2NrfSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgZ2V0QWRkcmVzc0luZGV4ZXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXRpc3RpY0RhdGEuX2FkZHJlc3NMaXN0LmdldFBhZ2VJbmRleGVzKCk7XG4gICAgfSxcblxuICAgIGdldEFkZHJlc3NlczogZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zdGF0aXN0aWNEYXRhLl9hZGRyZXNzTGlzdC5nZXRQYWdlRGF0YShpbmRleCk7XG4gICAgfSxcblxuICAgIGdldEN1cnJlbnRQbGVkZ2U6IGZ1bmN0aW9uIChhZGRyZXNzKSB7XG4gICAgICAgIGxldCBwcyA9IHRoaXMuX2N1cnJlbnREYXRhLmdldEN1cnJlbnRQbGVkZ2VzKGFkZHJlc3MpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBsZXQgcCA9IHBzW2ldO1xuICAgICAgICAgICAgaWYgKCFwLmUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9LFxuXG4gICAgZ2V0SGlzdG9yeVBsZWRnZUluZGV4ZXM6IGZ1bmN0aW9uIChhZGRyZXNzKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9oaXN0b3J5RGF0YS5nZXRIaXN0b3J5UGxlZGdlSW5kZXhlcyhhZGRyZXNzKTtcbiAgICB9LFxuXG4gICAgZ2V0SGlzdG9yeVBsZWRnZXM6IGZ1bmN0aW9uIChhZGRyZXNzLCBpbmRleCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faGlzdG9yeURhdGEuZ2V0SGlzdG9yeVBsZWRnZXMoYWRkcmVzcywgaW5kZXgpO1xuICAgIH0sXG5cbiAgICBnZXRUb3RhbERpc3RyaWJ1dGU6IGZ1bmN0aW9uIChhZGRyZXNzKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zdGF0aXN0aWNEYXRhLmdldE5hdChhZGRyZXNzKTtcbiAgICB9LFxuXG4gICAgZ2V0RGlzdHJpYnV0ZUluZGV4ZXM6IGZ1bmN0aW9uIChhZGRyZXNzKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9kaXN0cmlidXRlRGF0YS5nZXREaXN0cmlidXRlSW5kZXhlcyhhZGRyZXNzKTtcbiAgICB9LFxuXG4gICAgZ2V0RGlzdHJpYnV0ZXM6IGZ1bmN0aW9uIChhZGRyZXNzLCBpbmRleCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZGlzdHJpYnV0ZURhdGEuZ2V0RGlzdHJpYnV0ZXMoYWRkcmVzcywgaW5kZXgpO1xuICAgIH0sXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFBsZWRnZTtcbiIsICJBcmdzIjogIltcIm4xc3gyRFVwSG9XdHNHWHJodXB1Q0N4VXhldVdrWXJxVjVrXCJdIn1A1whKEAAAAAAAAAAAAAAABKgXyABSEAAAAAAAAAAAAAAAAAADDUBYAWJBiMqWHQC+Trbm79D59qNovgl9jgaA1O9RuMru49ahtU8oB4SHkD0Pp556/FAyUZ7eQDtDNNSLA0mK7ozgZW1xpgA=